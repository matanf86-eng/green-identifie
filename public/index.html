<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> 转 专拽</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: linear-gradient(135deg, #10b981 0%, #059669 100%); min-height: 100vh; }
        #splash { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: linear-gradient(135deg, #10b981 0%, #059669 100%); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; transition: opacity 0.5s; }
        #splash.hidden { opacity: 0; pointer-events: none; }
        .splash-icon { font-size: 6em; animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        .splash-title { font-size: 2em; font-weight: bold; color: white; margin-bottom: 10px; }
        #mainApp { opacity: 0; transition: opacity 0.5s; min-height: 100vh; }
        #mainApp.visible { opacity: 1; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; color: white; margin-bottom: 30px; padding-top: 20px; }
        .card { background: white; border-radius: 24px; padding: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); }
        .camera-container { width: 100%; aspect-ratio: 4/3; background: #000; border-radius: 20px; overflow: hidden; margin-bottom: 20px; }
        #video { width: 100%; height: 100%; object-fit: cover; }
        #canvas { display: none; }
        .preview-image { width: 100%; border-radius: 20px; margin-bottom: 20px; }
        .button-group { display: flex; gap: 12px; margin-bottom: 20px; }
        button { flex: 1; padding: 18px; font-size: 1.15em; font-weight: 600; border: none; border-radius: 16px; cursor: pointer; }
        .btn-primary { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; }
        .btn-secondary { background: #f3f4f6; color: #374151; }
        .result-container { display: none; text-align: center; }
        .result-container.show { display: block; }
        .result-icon { font-size: 4em; margin: 20px 0; }
        .result-title { font-size: 2em; font-weight: bold; margin-bottom: 16px; }
        .result-description { font-size: 1.05em; line-height: 1.7; margin-bottom: 20px; }
        .loading { display: none; text-align: center; padding: 40px; }
        .loading.show { display: block; }
        .spinner { border: 4px solid #f3f4f6; border-top: 4px solid #10b981; border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error { background: #fef2f2; color: #991b1b; padding: 16px; border-radius: 12px; margin-bottom: 16px; display: none; }
        .error.show { display: block; }
    </style>
</head>
<body>
    <div id="splash"><div class="splash-icon"></div><div class="splash-title"> 转 专拽</div></div>
    <div id="mainApp">
        <div class="container">
            <div class="header"><h1>  转 专拽</h1><p>住专  驻专?</p></div>
            <div class="card">
                <div id="cameraView"><div class="camera-container"><video id="video" autoplay playsinline></video><canvas id="canvas"></canvas></div><div class="button-group"><button class="btn-primary" onclick="captureAndAnalyze()"> 爪 </button></div></div>
                <div id="photoView" style="display: none;"><img id="preview" class="preview-image" /><div class="button-group"><button class="btn-primary" onclick="analyzeImage()">  注砖</button><button class="btn-secondary" onclick="retakePhoto()"> 爪 砖</button></div></div>
                <div class="error" id="error"></div>
                <div class="loading" id="loading"><div class="spinner"></div><p>转...</p></div>
                <div class="result-container" id="result"><div class="result-icon" id="resultIcon"></div><div class="result-title" id="resultTitle"></div><div class="result-description" id="resultDescription"></div><button class="btn-primary" onclick="reset()"> 拽 砖</button></div>
            </div>
        </div>
    </div>
    <script>
        let stream=null,capturedImageData=null;
        setTimeout(()=>{document.getElementById('splash').classList.add('hidden');document.getElementById('mainApp').classList.add('visible');},2500);
        async function initCamera(){try{stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});document.getElementById('video').srcObject=stream;}catch(e){showError(' 转 砖转 爪');}}
        function capturePhoto(){const v=document.getElementById('video'),c=document.getElementById('canvas');c.width=v.videoWidth;c.height=v.videoHeight;c.getContext('2d').drawImage(v,0,0);return c.toDataURL('image/jpeg',0.8);}
        function captureAndAnalyze(){capturedImageData=capturePhoto();document.getElementById('preview').src=capturedImageData;document.getElementById('cameraView').style.display='none';document.getElementById('photoView').style.display='block';if(stream)stream.getTracks().forEach(t=>t.stop());}
        async function analyzeImage(){document.getElementById('loading').classList.add('show');try{const r=await fetch('/api/analyze',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({image:capturedImageData.split(',')[1]})});const d=await r.json();displayResult(d);}catch(e){showError('砖');}finally{document.getElementById('loading').classList.remove('show');}}
        function displayResult(r){document.getElementById('photoView').style.display='none';const i={'住专':'','驻专':'',' 专专':''};document.getElementById('resultIcon').textContent=i[r.plant]||'';document.getElementById('resultTitle').textContent=r.plant;document.getElementById('resultDescription').textContent=r.explanation;document.getElementById('result').classList.add('show');}
        function showError(m){document.getElementById('error').textContent=m;document.getElementById('error').classList.add('show');}
        function retakePhoto(){document.getElementById('photoView').style.display='none';document.getElementById('cameraView').style.display='block';initCamera();}
        function reset(){document.getElementById('result').classList.remove('show');retakePhoto();}
        window.addEventListener('load',()=>setTimeout(initCamera,2500));
    </script>
</body>
</html>
